"""
人生スコア計算のための統計データ定数

東京で生まれ育って最大限に充実した人生 = 100点 を基準とする
"""

# ============================================================================
# 6段階ランク評価のしきい値
# 統計的スケール: 平均55点を基準に、正規分布的な評価
# 調整: SS=2-3%、S=5-8%、D=10%程度になるよう調整
# SS: 上位2-3%（87点以上）、S: 上位5-8%（78点以上）、A: 上位15%（68点以上）
# B: 平均付近（50-68点）、C: 下位（32-50点）、D: 下位10%（32点未満）
# ============================================================================
RANK_THRESHOLDS = {
    "SS": 87,  # 87点以上（上位2-3%相当）
    "S": 78,   # 78点以上（上位5-8%相当）
    "A": 68,   # 68点以上（上位15%相当）
    "B": 50,   # 50点以上（平均付近）
    "C": 32,   # 32点以上（下位）
    "D": 0,    # 32点未満（下位10%相当）
}

RANK_LABELS = {
    "SS": "神ガチャ",
    "S": "大当たり",
    "A": "当たり",
    "B": "普通",
    "C": "ハズレ",
    "D": "大ハズレ",
}

def get_rank(score: float) -> str:
    """
    スコアからランク（SS/S/A/B/C/D）を取得
    
    統計的スケール（調整後）:
    - SS: 87点以上（上位2-3%相当）
    - S: 78点以上（上位5-8%相当）
    - A: 68点以上（上位15%相当）
    - B: 50点以上（平均付近）
    - C: 32点以上（下位）
    - D: 32点未満（下位10%相当）
    
    Args:
        score: 0-100のスコア
        
    Returns:
        ランク文字列
    """
    if score >= RANK_THRESHOLDS["SS"]:
        return "SS"
    elif score >= RANK_THRESHOLDS["S"]:
        return "S"
    elif score >= RANK_THRESHOLDS["A"]:
        return "A"
    elif score >= RANK_THRESHOLDS["B"]:
        return "B"
    elif score >= RANK_THRESHOLDS["C"]:
        return "C"
    else:
        return "D"

def get_rank_label(rank: str) -> str:
    """
    ランクからラベルを取得
    
    Args:
        rank: ランク（SS/S/A/B/C/D）
        
    Returns:
        ラベル文字列
    """
    return RANK_LABELS.get(rank, "")

# ============================================================================
# 出生地による機会格差（有効求人倍率ベース）
# 出典: 厚生労働省 一般職業紹介状況（2025年11月）
# ============================================================================
LOCATION_SCORES = {
    "東京": 100,  # 有効求人倍率 1.73（基準）
    "北海道": 54,  # 有効求人倍率 0.93（1.73の約54%）
}

# ============================================================================
# 親ガチャスコア用定数
# ============================================================================

# 親の学歴スコア（パーセンタイルベース、2020年国勢調査データに基づく）
# 
# 出典: 2020年（令和2年）国勢調査「15歳以上卒業者の最終学歴分布」
# 
# 日本の学歴分布（15歳以上卒業者、2020年国勢調査）:
# - 大学院卒: 約2.5%
# - 大学卒: 約23.1%
# - 短大・高専卒: 約16.2%
# - 高校卒: 約44.2%
# - 小学校・中学校卒: 約8.1%
#
# 累積パーセンタイル（下位から）と中央値:
# - 中卒: 0-8.1%（中央値: 4.05%）
# - 高卒: 8.1-52.3%（中央値: 30.2%）
# - 短大・専門卒: 52.3-68.5%（中央値: 60.4%）
# - 大学卒: 68.5-91.6%（中央値: 80.05%）← ランク未指定時の平均
# - 大学院卒: 91.6-94.1%（中央値: 92.85%）← ランク未指定時の平均
#
# スコア変換式（正規分布的なスコアリング）:
# - percentile < 50: score = percentile * 1.2
# - percentile >= 50: score = 60 + (percentile - 50) * 0.8
#
# 計算結果:
# - 中卒: 4.05 * 1.2 = 4.86 → 0点（最低値）
# - 高卒: 30.2 * 1.2 = 36.24 → 36.2点
# - 短大・専門卒: 60 + (60.4 - 50) * 0.8 = 68.32 → 68.3点
# - 大学卒: 60 + (80.05 - 50) * 0.8 = 84.04 → 84.0点
# - 大学院卒: 60 + (92.85 - 50) * 0.8 = 94.28 → 94.3点
PARENT_EDUCATION_SCORES = {
    # 「卒」付きバージョン
    "大学院卒": 94.3,
    "大学卒": 84.0,
    "短大・専門卒": 68.3,
    "高校卒": 36.2,
    "中学卒": 0.0,
    # 「卒」なしバージョン（実際のデータ形式）
    "大学院": 94.3,
    "大学": 84.0,
    "短大・専門": 68.3,
    "短大・専門学校": 68.3,
    "短大": 68.3,
    "専門": 68.3,
    "専門学校": 68.3,
    "高校": 36.2,
    "中学": 0.0,
    "中学校": 0.0,
    "default": 36.2,  # 高卒（最頻値）をデフォルトに
}

# 世帯年収スコア（パーセンタイルベース）
# 
# 出典: 厚生労働省「国民生活基礎調査」令和4年（児童のいる世帯）
# 
# 児童のいる世帯の年収分布に基づき、各レンジの累積パーセンタイルを
# スコアに変換。中央値（500〜700万円）を60点、上位1%を99点、下位1%を1点に設定。
#
# 児童世帯の年収分布（推定）:
# - 200万円未満: 約5%
# - 200〜400万円: 約14%
# - 400〜600万円: 約23%
# - 600〜800万円: 約24%
# - 800〜1000万円: 約15%
# - 1000万円以上: 約19%
#
# スコア変換式（中央値60点基準）:
# - percentile >= 50: score = 60 + (percentile - 50) * (40 / 50)
# - percentile < 50: score = percentile * (60 / 50)
HOUSEHOLD_INCOME_SCORES = {
    # CSVデータのレンジに完全一致
    "100万円未満": 2,       # 下位約1%（パーセンタイル1）
    "100〜200万円": 5,      # 下位約3%（パーセンタイル3）
    "200〜300万円": 12,     # 下位約7%（パーセンタイル7）
    "300〜400万円": 22,     # 下位約15%（パーセンタイル15）
    "400〜500万円": 38,     # 下位約27%（パーセンタイル27）
    "500〜700万円": 60,     # 中央値付近（パーセンタイル50）
    "700〜1000万円": 78,    # 上位約25%（パーセンタイル75）
    "1000〜1500万円": 90,   # 上位約9%（パーセンタイル91）
    "1500万円以上": 98,     # 上位約4%（パーセンタイル96）
    # 旧レンジ（後方互換性のため残す）
    "1000万円以上": 94,     # 上位約6%相当
    "900〜1000万円": 85,
    "800〜1000万円": 82,
    "800〜900万円": 80,
    "700〜800万円": 72,
    "600〜800万円": 68,
    "600〜700万円": 65,
    "500〜600万円": 55,
    "400〜600万円": 48,
    "300〜500万円": 30,
    "200〜400万円": 17,
    "200万円未満": 8,
    "default": 60,
}

# 出生地スコア（親ガチャ用）
# 統計的スケール: 平均60点、最大（東京）100点、最小（最も機会の少ない地域）0点
# 東京100、北海道は全国平均より低いため50程度
BIRTHPLACE_SCORES = {
    "東京": 100,
    "北海道": 50,
    "default": 60,
}

# ============================================================================
# 性別による経済的機会格差
# 出典: 厚生労働省「賃金構造基本統計調査」2024年
# ============================================================================
GENDER_SCORES = {
    "男性": 100,  # 賃金100（基準）
    "女性": 76,   # 賃金75.8（男性の約76%）
}

# ============================================================================
# 学歴による生涯賃金格差（旧版 - 非推奨）
# 出典: 労働政策研究・研修機構「ユースフル労働統計」
# 
# 【非推奨】この辞書は後方互換性のため残していますが、
# 新しい実装では get_education_score() 関数を使用してください。
# ============================================================================
EDUCATION_SCORES = {
    "大学院卒": 100,  # 生涯賃金約3.2億円（上位3%）
    "大学卒": 85,     # 生涯賃金約2.7億円（上位約30%）
    "短大・専門卒": 65,  # 生涯賃金約2.3億円（中央値やや上）
    "高校卒": 50,     # 生涯賃金約2.0億円（中央値付近）
    "中学卒": 0,      # 生涯賃金約1.6億円（下位7%）
}

# ============================================================================
# 学歴スコアリング（パーセンタイルベース、2020年国勢調査データに基づく）
# 
# 出典: 2020年（令和2年）国勢調査「15歳以上卒業者の最終学歴分布」
# 
# 日本の学歴分布（15歳以上卒業者、2020年国勢調査）:
# - 大学院卒: 約2.5%（大学卒・大学院卒25.6%のうち）
# - 大学卒: 約23.1%（大学卒・大学院卒25.6%のうち）
# - 短大・高専卒: 約16.2%
# - 高校卒: 約44.2%
# - 小学校・中学校卒: 約8.1%
#
# 累積パーセンタイル（下位から）:
# - 中卒: 0-8.1%（中央値: 4.05%）
# - 高卒: 8.1-52.3%（中央値: 30.2%）
# - 短大・専門卒: 52.3-68.5%（中央値: 60.4%）
# - 大学卒: 68.5-91.6%（中央値: 80.05%）
# - 大学院卒: 91.6-94.1%（中央値: 92.85%）
#
# 大学ランク別の推定分布（大学卒23.1%を偏差値分布に基づいて分割）:
# - Sランク大学卒: 約2.3%（上位10%、累積: 89.2-91.6%、中央値: 90.4%）
# - Aランク大学卒: 約4.6%（上位10-20%、累積: 84.6-89.2%、中央値: 86.9%）
# - Bランク大学卒: 約9.2%（上位20-40%、累積: 75.4-84.6%、中央値: 80.0%）
# - Cランク大学卒: 約4.6%（上位40-50%、累積: 70.8-75.4%、中央値: 73.1%）
# - Dランク大学卒: 約2.3%（下位50%、累積: 68.5-70.8%、中央値: 69.65%）
#
# 大学院ランク別の推定分布（大学院卒2.5%を分割）:
# - Sランク大学院卒: 約0.4%（累積: 93.7-94.1%、中央値: 93.9%）
# - Aランク大学院卒: 約0.6%（累積: 93.1-93.7%、中央値: 93.4%）
# - Bランク大学院卒: 約0.8%（累積: 92.3-93.1%、中央値: 92.7%）
# - Cランク大学院卒: 約0.4%（累積: 91.9-92.3%、中央値: 92.1%）
# - Dランク大学院卒: 約0.3%（累積: 91.6-91.9%、中央値: 91.75%）
#
# スコア変換式（中央値60点基準、正規分布的なスコアリング）:
# - percentile < 50: score = percentile * (60 / 50) = percentile * 1.2
# - percentile >= 50: score = 60 + (percentile - 50) * (40 / 50) = 60 + (percentile - 50) * 0.8
# ============================================================================

# 学歴カテゴリ別のパーセンタイル情報（2020年国勢調査データに基づく）
EDUCATION_PERCENTILES = {
    # 下位から
    "中学卒": {
        "percentile_start": 0.0,
        "percentile_end": 8.1,
        "percentile_mid": 4.05,
    },
    "高校卒": {
        "percentile_start": 8.1,
        "percentile_end": 52.3,  # 8.1 + 44.2
        "percentile_mid": 30.2,  # (8.1 + 52.3) / 2
    },
    "短大・専門卒": {
        "percentile_start": 52.3,  # 8.1 + 44.2
        "percentile_end": 68.5,   # 52.3 + 16.2
        "percentile_mid": 60.4,   # (52.3 + 68.5) / 2
    },
    # 大学卒（ランク別）
    "大学卒_D": {
        "percentile_start": 68.5,  # 8.1 + 44.2 + 16.2
        "percentile_end": 70.8,    # 68.5 + 2.3
        "percentile_mid": 69.65,   # (68.5 + 70.8) / 2
    },
    "大学卒_C": {
        "percentile_start": 70.8,
        "percentile_end": 75.4,    # 70.8 + 4.6
        "percentile_mid": 73.1,    # (70.8 + 75.4) / 2
    },
    "大学卒_B": {
        "percentile_start": 75.4,
        "percentile_end": 84.6,    # 75.4 + 9.2
        "percentile_mid": 80.0,    # (75.4 + 84.6) / 2
    },
    "大学卒_A": {
        "percentile_start": 84.6,
        "percentile_end": 89.2,    # 84.6 + 4.6
        "percentile_mid": 86.9,    # (84.6 + 89.2) / 2
    },
    "大学卒_S": {
        "percentile_start": 89.2,
        "percentile_end": 91.6,    # 89.2 + 2.3
        "percentile_mid": 90.4,    # (89.2 + 91.6) / 2
    },
    # 大学院卒（ランク別）
    "大学院卒_D": {
        "percentile_start": 91.6,  # 8.1 + 44.2 + 16.2 + 23.1
        "percentile_end": 91.9,    # 91.6 + 0.3
        "percentile_mid": 91.75,   # (91.6 + 91.9) / 2
    },
    "大学院卒_C": {
        "percentile_start": 91.9,
        "percentile_end": 92.3,    # 91.9 + 0.4
        "percentile_mid": 92.1,    # (91.9 + 92.3) / 2
    },
    "大学院卒_B": {
        "percentile_start": 92.3,
        "percentile_end": 93.1,    # 92.3 + 0.8
        "percentile_mid": 92.7,    # (92.3 + 93.1) / 2
    },
    "大学院卒_A": {
        "percentile_start": 93.1,
        "percentile_end": 93.7,    # 93.1 + 0.6
        "percentile_mid": 93.4,    # (93.1 + 93.7) / 2
    },
    "大学院卒_S": {
        "percentile_start": 93.7,
        "percentile_end": 94.1,    # 93.7 + 0.4
        "percentile_mid": 93.9,    # (93.7 + 94.1) / 2
    },
    # 東京大学大学院卒（特別扱い）
    "東京大学大学院卒": {
        "percentile_start": 94.0,
        "percentile_end": 94.1,
        "percentile_mid": 94.05,   # (94.0 + 94.1) / 2
    },
}


def _calculate_score_from_percentile(percentile: float) -> float:
    """
    パーセンタイルからスコアを計算（正規分布的なスコアリング）
    
    Args:
        percentile: パーセンタイル（0-100）
    
    Returns:
        スコア（0-100点）
    """
    if percentile < 50:
        score = percentile * 1.2
    else:
        score = 60 + (percentile - 50) * 0.8
    
    return max(0.0, min(100.0, score))


# 学歴カテゴリ別のスコア（パーセンタイルベース、中央値60点）
# 2020年国勢調査データに基づいて計算
EDUCATION_SCORE_MAP = {
    # 下位から
    "中学卒": 0.0,      # 4.05% → 4.86点 → 0点（最低値として設定）
    "高校卒": round(_calculate_score_from_percentile(30.2), 1),      # 30.2% → 36.24点
    "短大・専門卒": round(_calculate_score_from_percentile(60.4), 1),  # 60.4% → 68.32点
    # 大学卒（ランク別）
    "大学卒_D": round(_calculate_score_from_percentile(69.65), 1),   # 69.65% → 75.72点
    "大学卒_C": round(_calculate_score_from_percentile(73.1), 1),    # 73.1% → 78.48点
    "大学卒_B": round(_calculate_score_from_percentile(80.0), 1),    # 80.0% → 84.0点
    "大学卒_A": round(_calculate_score_from_percentile(86.9), 1),    # 86.9% → 89.52点
    "大学卒_S": round(_calculate_score_from_percentile(90.4), 1),    # 90.4% → 92.32点
    # 大学院卒（ランク別）
    "大学院卒_D": round(_calculate_score_from_percentile(91.75), 1), # 91.75% → 93.4点
    "大学院卒_C": round(_calculate_score_from_percentile(92.1), 1),  # 92.1% → 93.68点
    "大学院卒_B": round(_calculate_score_from_percentile(92.7), 1),  # 92.7% → 94.16点
    "大学院卒_A": round(_calculate_score_from_percentile(93.4), 1),  # 93.4% → 94.72点
    "大学院卒_S": round(_calculate_score_from_percentile(93.9), 1),  # 93.9% → 95.12点
    # 東京大学大学院卒（特別扱い）
    "東京大学大学院卒": 100.0,  # 最高値
}


def get_education_score(
    education_level: str,
    university_rank: str = None,
    university_name: str = None,
) -> float:
    """
    最終学歴スコアをパーセンタイルベースで計算（2020年国勢調査データに基づく）
    
    統計的根拠:
    - 2020年（令和2年）国勢調査「15歳以上卒業者の最終学歴分布」に基づく
    - パーセンタイルベースで正規分布的なスコアリングを実装
    - 中央値60点、東京大学大学院卒100点、中卒0点のスコア体系
    
    学歴分布（2020年国勢調査）:
    - 大学院卒: 約2.5%
    - 大学卒: 約23.1%
    - 短大・高専卒: 約16.2%
    - 高校卒: 約44.2%
    - 小学校・中学校卒: 約8.1%
    
    スコア変換式:
    - percentile < 50: score = percentile * 1.2
    - percentile >= 50: score = 60 + (percentile - 50) * 0.8
    
    Args:
        education_level: 学歴レベル（"大学院卒"/"大学卒"/"短大・専門卒"/"高校卒"/"中学卒"）
        university_rank: 大学ランク（"S"/"A"/"B"/"C"/"D"）。大学卒・大学院卒の場合のみ
        university_name: 大学名（辞書形式の場合も考慮）。東京大学判定用
    
    Returns:
        スコア（0-100点）
    """
    # 大学名が辞書形式の場合、nameキーから取得
    if isinstance(university_name, dict):
        university_name = university_name.get("name", "")
    elif university_name is None:
        university_name = ""
    
    # 東京大学大学院卒の特別処理
    if education_level == "大学院卒" and university_name == "東京大学":
        key = "東京大学大学院卒"
    # 大学院卒（ランク別）
    elif education_level == "大学院卒" and university_rank:
        key = f"大学院卒_{university_rank}"
    # 大学卒（ランク別）
    elif education_level == "大学卒" and university_rank:
        key = f"大学卒_{university_rank}"
    # その他の学歴
    else:
        key = education_level
    
    # スコアマップから取得
    score = EDUCATION_SCORE_MAP.get(key)
    if score is None:
        # フォールバック: 旧EDUCATION_SCORESを使用
        score = float(EDUCATION_SCORES.get(education_level, 50))
    
    return round(score, 1)

# ============================================================================
# 大学進学先による機会格差
# 出典: 大学所在地の求人倍率と産業集積度
# ============================================================================
UNIVERSITY_DESTINATION_SCORES = {
    "東京都": 100,
    "神奈川県": 90,
    "大阪府": 85,
    "愛知県": 85,
    "京都府": 80,
    "兵庫県": 75,
    "福岡県": 70,
    "北海道": 60,
    "default": 65,
}

# ============================================================================
# 大学偏差値ランク別スコア
# ランク: S（難関国公立・早慶）、A（上位国公立・MARCH関関同立）、
#        B（中堅国公立・日東駒専）、C（その他国公立・中堅私立）、D（その他私立）
# ============================================================================
UNIVERSITY_RANK_SCORES = {
    "S": 100,  # 東大・京大・一橋・東工大・旧帝大・早慶
    "A": 90,   # 上位国公立・MARCH・関関同立
    "B": 80,   # 中堅国公立・日東駒専・産近甲龍
    "C": 70,   # その他国公立・中堅私立
    "D": 60,   # その他私立
    "default": 70,
}

# 大学名からランクへのマッピング
UNIVERSITY_RANKS = {
    # S ランク（難関国公立・早慶）
    "東京大学": "S",
    "京都大学": "S",
    "一橋大学": "S",
    "東京工業大学": "S",
    "北海道大学": "S",
    "東北大学": "S",
    "名古屋大学": "S",
    "大阪大学": "S",
    "九州大学": "S",
    "早稲田大学": "S",
    "慶應義塾大学": "S",
    "東京医科歯科大学": "S",
    "旭川医科大学": "S",
    "札幌医科大学": "S",
    
    # A ランク（上位国公立・MARCH・関関同立）
    "筑波大学": "A",
    "神戸大学": "A",
    "横浜国立大学": "A",
    "千葉大学": "A",
    "広島大学": "A",
    "岡山大学": "A",
    "金沢大学": "A",
    "お茶の水女子大学": "A",
    "東京外国語大学": "A",
    "東京農工大学": "A",
    "電気通信大学": "A",
    "東京海洋大学": "A",
    "東京学芸大学": "A",
    "首都大学東京": "A",
    "大阪公立大学": "A",
    "小樽商科大学": "A",
    "帯広畜産大学": "A",
    "室蘭工業大学": "A",
    "北見工業大学": "A",
    "公立はこだて未来大学": "A",
    "国際教養大学": "A",
    "会津大学": "A",
    # MARCH
    "明治大学": "A",
    "青山学院大学": "A",
    "立教大学": "A",
    "中央大学": "A",
    "法政大学": "A",
    # 関関同立
    "関西大学": "A",
    "関西学院大学": "A",
    "同志社大学": "A",
    "立命館大学": "A",
    # 上智・理科大
    "上智大学": "A",
    "東京理科大学": "A",
    
    # B ランク（中堅国公立・日東駒専・産近甲龍）
    "北海道教育大学": "B",
    "弘前大学": "B",
    "岩手大学": "B",
    "秋田大学": "B",
    "山形大学": "B",
    "福島大学": "B",
    "茨城大学": "B",
    "宇都宮大学": "B",
    "群馬大学": "B",
    "埼玉大学": "B",
    "新潟大学": "B",
    "信州大学": "B",
    "静岡大学": "B",
    "名古屋工業大学": "B",
    "岐阜大学": "B",
    "三重大学": "B",
    "滋賀大学": "B",
    "和歌山大学": "B",
    "鳥取大学": "B",
    "島根大学": "B",
    "山口大学": "B",
    "徳島大学": "B",
    "香川大学": "B",
    "愛媛大学": "B",
    "高知大学": "B",
    "佐賀大学": "B",
    "長崎大学": "B",
    "熊本大学": "B",
    "大分大学": "B",
    "宮崎大学": "B",
    "鹿児島大学": "B",
    "琉球大学": "B",
    "長岡技術科学大学": "B",
    "富山大学": "B",
    "福井大学": "B",
    "山梨大学": "B",
    "奈良女子大学": "B",
    "大阪教育大学": "B",
    "京都工芸繊維大学": "B",
    "京都教育大学": "B",
    "兵庫教育大学": "B",
    "九州工業大学": "B",
    "福岡教育大学": "B",
    "宮城教育大学": "B",
    "愛知教育大学": "B",
    "奈良教育大学": "B",
    "鳴門教育大学": "B",
    "札幌市立大学": "B",
    "公立千歳科学技術大学": "B",
    "横浜市立大学": "B",
    "名古屋市立大学": "B",
    "京都府立大学": "B",
    "神戸市外国語大学": "B",
    "兵庫県立大学": "B",
    "北九州市立大学": "B",
    # 日東駒専
    "日本大学": "B",
    "東洋大学": "B",
    # 産近甲龍
    "京都産業大学": "B",
    "近畿大学": "B",
    "甲南大学": "B",
    "龍谷大学": "B",
    # 南山・西南学院
    "南山大学": "B",
    "西南学院大学": "B",
    
    # C ランク（その他公立・中堅私立）
    "北海学園大学": "C",
    "北星学園大学": "C",
    "北海道科学大学": "C",
    "酪農学園大学": "C",
    "北海道医療大学": "C",
    "天使大学": "C",
    "藤女子大学": "C",
    "東北学院大学": "C",
    "東北福祉大学": "C",
    "獨協大学": "C",
    "文教大学": "C",
    "神田外語大学": "C",
    "千葉工業大学": "C",
    "神奈川大学": "C",
    "東海大学": "C",
    "中京大学": "C",
    "愛知大学": "C",
    "名城大学": "C",
    "愛知学院大学": "C",
    "関西外国語大学": "C",
    "摂南大学": "C",
    "広島修道大学": "C",
    "福岡大学": "C",
    "久留米大学": "C",
    "立命館アジア太平洋大学": "C",
    "金沢工業大学": "C",
    "松山大学": "C",
    "沖縄国際大学": "C",
    
    # D ランク（その他私立）- 明示的にリストに入れず、defaultで対応
}

def get_university_rank(university_name: str) -> str:
    """
    大学名からランクを取得
    
    Args:
        university_name: 大学名
        
    Returns:
        ランク（S/A/B/C/D）
    """
    if not university_name:
        return "default"
    return UNIVERSITY_RANKS.get(university_name, "D")

def get_university_rank_score(university_name: str) -> int:
    """
    大学名からスコアを取得
    
    Args:
        university_name: 大学名
        
    Returns:
        スコア（60〜100）
    """
    rank = get_university_rank(university_name)
    return UNIVERSITY_RANK_SCORES.get(rank, UNIVERSITY_RANK_SCORES["default"])

# ============================================================================
# 産業別の平均賃金スコア
# 出典: 厚生労働省「賃金構造基本統計調査」2024年
# ============================================================================
INDUSTRY_SALARY_SCORES = {
    "情報通信業": 100,
    "金融業，保険業": 95,
    "学術研究，専門・技術サービス業": 90,
    "電気・ガス・熱供給・水道業": 90,
    "教育，学習支援業": 85,
    "不動産業，物品賃貸業": 80,
    "製造業": 80,
    "建設業": 75,
    "運輸業，郵便業": 70,
    "卸売業，小売業": 65,
    "医療，福祉": 65,
    "複合サービス事業": 60,
    "サービス業（他に分類されないもの）": 55,
    "生活関連サービス業，娯楽業": 55,
    "農業，林業": 50,
    "漁業": 50,
    "宿泊業，飲食サービス業": 45,
    "default": 60,
}

# ============================================================================
# 死因によるスコア調整
# 「老衰」で亡くなるのは最も自然な死（高スコア）
# ============================================================================
DEATH_CAUSE_SCORES = {
    "老衰": 100,
    "その他": 80,
    "不慮の事故": 40,
    "自殺": 20,
    "default": 70,
}

# ============================================================================
# 各要素の重み（合計100%）
# ============================================================================
SCORE_WEIGHTS = {
    "location": 0.20,      # 出生地（20%）
    "gender": 0.15,        # 性別（15%）
    "education": 0.20,     # 学歴（20%）
    "university_dest": 0.05,  # 大学進学先（5%）
    "industry": 0.15,      # 就職産業（15%）
    "lifespan": 0.15,      # 寿命（15%）
    "death_cause": 0.10,   # 死因（10%）
}


def get_lifespan_score(age: int, gender: str) -> int:
    """
    寿命に基づくスコアを計算（長寿であるほど高スコア）
    
    統計的スケール: 平均60点、最大（100歳）100点、最小（0歳）0点
    平均寿命（男性81歳、女性87歳）が60点になるよう調整
    
    出典: 厚生労働省「簡易生命表」2024年（平均寿命: 男性81.09歳、女性87.13歳）
    
    Args:
        age: 死亡時の年齢
        gender: 性別（"男性" or "女性"）
        
    Returns:
        0-100のスコア
    """
    # 性別に応じた平均寿命
    if gender == "女性":
        avg_lifespan = 87.13
        max_age = 105  # 最大想定年齢
    else:
        avg_lifespan = 81.09
        max_age = 100  # 最大想定年齢
    
    min_age = 0  # 最小年齢
    
    # 平均寿命を60点とする変換
    # スコア = 60 + (age - avg_lifespan) * (40 / (max_age - avg_lifespan)) for age >= avg_lifespan
    # スコア = 60 - (avg_lifespan - age) * (60 / avg_lifespan) for age < avg_lifespan
    
    if age >= max_age:
        return 100
    elif age <= min_age:
        return 0
    elif age >= avg_lifespan:
        # 平均寿命以上: 60点から100点の範囲
        score = 60 + (age - avg_lifespan) * (40 / (max_age - avg_lifespan))
        return min(100, int(score))
    else:
        # 平均寿命未満: 0点から60点の範囲
        score = 60 * (age / avg_lifespan)
        return max(0, int(score))


# ============================================================================
# 人生スコア用：生涯年収関連
# ============================================================================

# 学歴別の基準生涯年収（万円）
# 出典: 労働政策研究・研修機構「ユースフル労働統計」
LIFETIME_INCOME_BASE = {
    "大学院卒": 32000,  # 3.2億円（大学卒の約1.2倍）
    "大学卒": 27000,    # 2.7億円
    "短大・専門卒": 23000,  # 2.3億円（大学卒と高校卒の中間）
    "高校卒": 20000,    # 2.0億円
    "中学卒": 16000,    # 1.6億円
}

# ============================================================================
# 生涯年収スコアの基準（パーセンタイル方式）
# 統計的スケール: 中央値60点、上位1%で100点、下位1%で0点
# 出典: 労働政策研究・研修機構「ユースフル労働統計」、厚生労働省「賃金構造基本統計調査」
# ============================================================================

# 生涯年収のパーセンタイル分布（万円）
# 男女・学歴・雇用形態混合の全労働者ベース
# 
# 上位層データ出典:
# - 国税庁「民間給与実態統計調査」2024年
#   - 年収2,000万円超: 0.69%（145人に1人）
#   - 年収3,000万円超: 0.19%（315人に1人）
#   - 年収5,000万円超: 0.09%（797人に1人）
#   - 年収1億円以上: 0.037%（2,725人に1人）
# - 生涯年収への換算: 勤務40年として年収×40で概算
#   （実際は昇給カーブや資本所得を含むため調整）
#
LIFETIME_INCOME_PERCENTILES = [
    # (パーセンタイル, 生涯年収万円)
    (1, 5000),       # 下位1%: 0.5億円（非正規・短期間就労など）
    (5, 8000),       # 下位5%: 0.8億円
    (10, 12000),     # 下位10%: 1.2億円
    (25, 16000),     # 下位25%: 1.6億円
    (50, 22000),     # 中央値: 2.2億円
    (75, 28000),     # 上位25%: 2.8億円
    (90, 35000),     # 上位10%: 3.5億円
    (95, 42000),     # 上位5%: 4.2億円
    (99, 55000),     # 上位1%: 5.5億円
    # === 超高所得層（国税庁データに基づく） ===
    (99.31, 80000),   # 上位0.69%: 8億円（年収2,000万円超、145人に1人）
    (99.63, 100000),  # 上位0.37%: 10億円（年収2,500万円級）
    (99.81, 160000),  # 上位0.19%: 16億円（年収3,000-5,000万円、315人に1人）
    (99.91, 300000),  # 上位0.09%: 30億円（年収5,000万-1億円、797人に1人）
    (99.963, 500000), # 上位0.037%: 50億円（年収1億円以上、2,725人に1人）
    # === 超富裕層（起業家・経営者・投資家） ===
    (99.99, 2000000),  # 上位0.01%: 200億円（成功した起業家）
    (99.999, 70000000), # 上位0.001%: 7000億円（Forbes長者番付級）
]

def _income_to_percentile(lifetime_income: float) -> float:
    """
    生涯年収からパーセンタイルを計算（線形補間）

    Args:
        lifetime_income: 生涯年収（万円）

    Returns:
        パーセンタイル（0-100）
    """
    # 範囲外の場合
    if lifetime_income <= LIFETIME_INCOME_PERCENTILES[0][1]:
        return LIFETIME_INCOME_PERCENTILES[0][0]
    if lifetime_income >= LIFETIME_INCOME_PERCENTILES[-1][1]:
        return LIFETIME_INCOME_PERCENTILES[-1][0]

    # 線形補間でパーセンタイルを計算
    for i in range(len(LIFETIME_INCOME_PERCENTILES) - 1):
        p1, income1 = LIFETIME_INCOME_PERCENTILES[i]
        p2, income2 = LIFETIME_INCOME_PERCENTILES[i + 1]

        if income1 <= lifetime_income <= income2:
            # 線形補間
            ratio = (lifetime_income - income1) / (income2 - income1)
            return p1 + ratio * (p2 - p1)

    return 50  # フォールバック

def get_lifetime_income_score(lifetime_income: float) -> int:
    """
    生涯年収からスコアを計算（パーセンタイル方式、中央値60点）

    パーセンタイル方式:
    - 中央値（50パーセンタイル）= 60点
    - 上位1%（99パーセンタイル）= 100点
    - 下位1%（1パーセンタイル）= 0点

    出典: 労働政策研究・研修機構「ユースフル労働統計」

    Args:
        lifetime_income: 生涯年収（万円）

    Returns:
        0-100のスコア
    """
    percentile = _income_to_percentile(lifetime_income)

    # パーセンタイルを中央値60点にマッピング
    # 50%以上: 60 + (percentile - 50) * (40 / 49)  → 50%=60点、99%=100点
    # 50%未満: percentile * (60 / 50)  → 0%=0点、50%=60点

    if percentile >= 50:
        score = 60 + (percentile - 50) * (40 / 49)
    else:
        score = percentile * (60 / 50)

    return max(0, min(100, int(score)))


# ============================================================================
# 企業規模別の賃金補正係数
# 出典: 厚生労働省「令和5年賃金構造基本統計調査」
# 大企業（1000人以上）を基準(1.00)とした場合の賃金比率
# ============================================================================
COMPANY_SIZE_SALARY_MULTIPLIER = {
    "大企業": 1.00,   # 1000人以上（基準）
    "中企業": 0.82,   # 100-999人（大企業の約82%）
    "小企業": 0.72,   # 10-99人（大企業の約72%）
    "default": 0.82,  # デフォルトは中企業
}

# 学歴別の企業規模分布（%）
# 出典: 文部科学省「学校基本調査」、リクルートワークス研究所
# 大卒は大企業への就職率が高く、高卒・中卒は中小企業が中心
COMPANY_SIZE_DISTRIBUTION_BY_EDUCATION = {
    "大学卒": {
        "大企業": 35,   # 大卒の約35%が従業員1000人以上企業に就職
        "中企業": 40,   # 約40%が100-999人企業
        "小企業": 25,   # 約25%が99人以下企業
    },
    "短大・専門卒": {
        "大企業": 20,   # 短大・専門卒の約20%が大企業
        "中企業": 45,   # 約45%が中企業
        "小企業": 35,   # 約35%が小企業
    },
    "高校卒": {
        "大企業": 15,   # 高卒の約15%が大企業
        "中企業": 45,   # 約45%が中企業
        "小企業": 40,   # 約40%が小企業
    },
    "中学卒": {
        "大企業": 5,    # 中卒はほとんど大企業に入れない
        "中企業": 30,   # 約30%が中企業
        "小企業": 65,   # 約65%が小企業
    },
    "default": {
        "大企業": 20,
        "中企業": 40,
        "小企業": 40,
    },
}

# ============================================================================
# 学歴別の産業分布（%）
# 出典: 
# - 厚生労働省「令和6年雇用動向調査」2024年
# - 株式会社ジンジブ「高卒採用の市場データ」2024年
# - 文部科学省「令和6年度学校基本調査」
# 
# 大卒と高卒では就職先の産業構成が大きく異なる
# ============================================================================
INDUSTRY_DISTRIBUTION_BY_EDUCATION = {
    # 大学卒（東京都の特徴：情報通信・金融・学術研究が高い）
    "大学卒": {
        "情報通信業": 12.0,
        "製造業": 13.0,
        "卸売業・小売業": 12.0,
        "学術研究・専門・技術サービス業": 10.0,
        "医療・福祉": 9.0,
        "金融業・保険業": 7.0,
        "建設業": 6.0,
        "教育・学習支援業": 6.0,
        "宿泊業・飲食サービス業": 5.0,
        "不動産業・物品賃貸業": 4.0,
        "運輸業・郵便業": 4.0,
        "公務員": 4.0,
        "サービス業（他に分類されないもの）": 8.0,
    },
    # 大学院卒（研究・専門職が多い）
    "大学院卒": {
        "学術研究・専門・技術サービス業": 18.0,
        "情報通信業": 15.0,
        "製造業": 20.0,
        "教育・学習支援業": 12.0,
        "医療・福祉": 10.0,
        "金融業・保険業": 5.0,
        "公務員": 5.0,
        "建設業": 4.0,
        "卸売業・小売業": 4.0,
        "不動産業・物品賃貸業": 2.0,
        "運輸業・郵便業": 1.0,
        "宿泊業・飲食サービス業": 1.0,
        "サービス業（他に分類されないもの）": 3.0,
    },
    # 高校卒（製造業が約4割と圧倒的）
    "高校卒": {
        "製造業": 39.9,
        "卸売業・小売業": 10.6,
        "建設業": 8.6,
        "公務員": 7.3,
        "運輸業・郵便業": 6.1,
        "医療・福祉": 5.5,
        "宿泊業・飲食サービス業": 5.2,
        "サービス業（他に分類されないもの）": 6.2,
        "生活関連サービス業・娯楽業": 4.0,
        "情報通信業": 1.2,
        "金融業・保険業": 1.5,
        "不動産業・物品賃貸業": 1.0,
        "学術研究・専門・技術サービス業": 0.5,
        "教育・学習支援業": 1.0,
        "電気・ガス・熱供給・水道業": 1.4,
    },
    # 短大・専門卒（医療・福祉、サービス業が多い）
    "短大・専門卒": {
        "医療・福祉": 25.0,
        "卸売業・小売業": 12.0,
        "宿泊業・飲食サービス業": 10.0,
        "製造業": 10.0,
        "サービス業（他に分類されないもの）": 8.0,
        "建設業": 6.0,
        "情報通信業": 6.0,
        "教育・学習支援業": 5.0,
        "生活関連サービス業・娯楽業": 5.0,
        "運輸業・郵便業": 4.0,
        "金融業・保険業": 3.0,
        "不動産業・物品賃貸業": 2.0,
        "学術研究・専門・技術サービス業": 2.0,
        "公務員": 2.0,
    },
    # 中学卒（製造業、建設業、サービス業が中心）
    "中学卒": {
        "製造業": 30.0,
        "建設業": 20.0,
        "サービス業（他に分類されないもの）": 15.0,
        "卸売業・小売業": 10.0,
        "宿泊業・飲食サービス業": 8.0,
        "運輸業・郵便業": 7.0,
        "生活関連サービス業・娯楽業": 5.0,
        "農業・林業": 3.0,
        "医療・福祉": 2.0,
    },
}

# ============================================================================
# 雇用形態別の賃金補正係数
# 出典: 厚生労働省「令和5年賃金構造基本統計調査」
# 正社員を基準(1.00)とした場合の賃金比率
# ============================================================================
EMPLOYMENT_TYPE_SALARY_MULTIPLIER = {
    "正社員": 1.00,    # 正社員（基準）
    "非正規": 0.65,    # 非正規雇用（正社員の約65%）
    "default": 1.00,
}

# 学歴・性別別の正社員率（%）
# 出典: 総務省「労働力調査」2024年
# 学歴が高いほど正社員率が高い、女性は男性より正社員率が低い傾向
EMPLOYMENT_TYPE_DISTRIBUTION = {
    "大学卒": {
        "男性": {"正社員": 90, "非正規": 10},
        "女性": {"正社員": 75, "非正規": 25},
    },
    "短大・専門卒": {
        "男性": {"正社員": 80, "非正規": 20},
        "女性": {"正社員": 65, "非正規": 35},
    },
    "高校卒": {
        "男性": {"正社員": 75, "非正規": 25},
        "女性": {"正社員": 55, "非正規": 45},
    },
    "中学卒": {
        "男性": {"正社員": 55, "非正規": 45},
        "女性": {"正社員": 35, "非正規": 65},
    },
    "default": {
        "男性": {"正社員": 75, "非正規": 25},
        "女性": {"正社員": 55, "非正規": 45},
    },
}


# ============================================================================
# 起業家・経営者関連の定数
# 
# 出典:
# - 総務省「令和4年就業構造基本調査」: 自営業主は全有業者の7.6%
# - 日本政策金融公庫「2024年度新規開業実態調査」: 
#   - 開業者の学歴: 大学・大学院35.5%、高校28.0%、専修・各種学校27.9%
#   - 開業時平均年齢: 43.6歳
# - 中小企業庁「中小企業白書」2024年: 
#   - 開業率3.9%、廃業率3.3%
#   - 企業生存率: 1年後95.3%、3年後88.1%、5年後80.7%
# - ベンチャー企業生存率: 5年後15%、10年後6.3%
# ============================================================================

# 生涯で起業する確率（学歴別、%）
# 全有業者の7.6%が自営業主、学歴別の開業者構成比から推定
# 大卒の起業率を基準として、学歴別の開業者構成比で調整
ENTREPRENEUR_PROBABILITY = {
    "大学院卒": 3.5,   # 3.5%（研究からスピンオフ、技術系起業）
    "大学卒": 3.0,     # 3.0%（開業者の35.5%が大卒）
    "短大・専門卒": 2.8, # 2.8%（開業者の27.9%が専修学校卒）
    "高校卒": 2.5,     # 2.5%（開業者の28.0%が高卒）
    "中学卒": 1.5,     # 1.5%（低学歴での起業は少ない）
    "default": 2.5,
}

# 起業成功度合いの確率分布
# 出典: 中小企業白書、ベンチャー企業生存率データ
# 
# 起業後の収入レベル（基準生涯年収に対する倍率）:
# - 廃業・失敗: 0.3倍（借金を抱えることも）
# - 零細自営: 0.7倍（平均以下の収入で継続）
# - 小規模成功: 1.2倍（従業員を雇用、安定経営）
# - 中規模成功: 3.0倍（年商数億円規模）
# - 大成功: 10.0倍（年商数十億円、上場準備）
# - 大企業創業者: 50.0倍（上場企業創業者）
# - Forbes級: 500.0倍（柳井正、孫正義レベル）
ENTREPRENEUR_SUCCESS_TIERS = [
    {"probability": 0.25, "multiplier": 0.3, "label": "廃業・失敗", "description": "起業後5年以内に廃業"},
    {"probability": 0.35, "multiplier": 0.7, "label": "零細自営", "description": "個人事業として継続、収入は平均以下"},
    {"probability": 0.25, "multiplier": 1.2, "label": "小規模成功", "description": "従業員数名、安定した経営"},
    {"probability": 0.10, "multiplier": 3.0, "label": "中規模成功", "description": "従業員数十名、年商数億円"},
    {"probability": 0.035, "multiplier": 10.0, "label": "大成功", "description": "従業員100名超、上場準備クラス"},
    {"probability": 0.014, "multiplier": 50.0, "label": "大企業創業者", "description": "上場企業、年商100億円以上"},
    {"probability": 0.001, "multiplier": 500.0, "label": "Forbes級", "description": "日本長者番付入りクラス"},
]

# 役員昇進確率（大企業勤務の場合のみ適用、%）
# 出典: 
# - 上場企業役員数約50,000人 / 大企業正社員約500万人 = 約1%
# - ただし、大学ランクで大きく異なる
# - 役員報酬1億円以上は1,120人（上場企業）
EXECUTIVE_PROMOTION_PROBABILITY = {
    "大学院卒_S": 5.0,   # 5.0%（東大・京大院卒は役員輩出率が高い）
    "大学卒_S": 4.0,     # 4.0%（旧帝大・早慶卒）
    "大学卒_A": 2.5,     # 2.5%（MARCH・関関同立卒）
    "大学卒_B": 1.0,     # 1.0%（中堅大卒）
    "大学卒_C": 0.5,     # 0.5%
    "大学卒_D": 0.3,     # 0.3%
    "default": 0.5,
}

# 役員レベル別の収入倍率と確率分布
# 出典:
# - デロイト「役員報酬サーベイ2025年度版」
# - CEO・社長報酬中央値: 1.24億円（売上1兆円以上）
# - 従業員平均給与: 633万円
# - 最高報酬: 77.32億円
EXECUTIVE_INCOME_TIERS = [
    {"probability": 0.60, "multiplier": 2.0, "label": "取締役", "description": "取締役・執行役員クラス"},
    {"probability": 0.25, "multiplier": 3.5, "label": "常務・専務", "description": "常務取締役・専務取締役"},
    {"probability": 0.12, "multiplier": 6.0, "label": "副社長", "description": "副社長・代表取締役"},
    {"probability": 0.028, "multiplier": 15.0, "label": "社長・CEO", "description": "社長・CEO（大企業）"},
    {"probability": 0.002, "multiplier": 50.0, "label": "トップ報酬", "description": "報酬1億円超の経営者"},
]

# 中小企業経営者の収入倍率（起業しない場合でも経営者になるルート）
# 出典: 中小企業庁調査、人事院調査
# - 中小企業社長平均: 約2,000万円
# - 従業員500人以上企業社長: 約4,200-8,600万円
SALARIED_EXECUTIVE_MULTIPLIER = {
    "中小企業役員": 1.5,    # 従業員平均の1.5倍程度
    "中小企業社長": 2.5,    # 従業員平均の2.5倍程度
    "中堅企業社長": 4.0,    # 従業員平均の4倍程度
    "大企業部長": 1.8,      # 管理職上位
}

# ============================================================================
# 年代別死因分布（厚生労働省 人口動態統計 2024年に基づく）
#
# 出典:
# - 厚生労働省「令和6年(2024)人口動態統計月報年計(概数)の概況」
# - 厚生労働省「死因順位(第5位まで)別にみた年齢階級・性別死亡数・死亡率」
# - いのち支える自殺対策推進センター「自殺の実態」
#
# 主な特徴:
# - 10-39歳: 自殺が死因第1位（G7で日本のみの特徴）
# - 40歳以降: 悪性新生物（がん）が第1位
# - 90歳以上: 老衰が第1位に上昇
# ============================================================================
AGE_BASED_DEATH_CAUSES = {
    # 0-9歳: 乳幼児・小児期（先天性疾患、不慮の事故が多い）
    "0-9": {
        "先天奇形等": 0.30,
        "不慮の事故": 0.25,
        "悪性新生物＜腫瘍＞": 0.15,
        "心疾患": 0.08,
        "肺炎": 0.07,
        "その他": 0.15,
    },
    # 10-19歳: 思春期・青年期前期（自殺が第1位）
    "10-19": {
        "自殺": 0.50,
        "不慮の事故": 0.20,
        "悪性新生物＜腫瘍＞": 0.12,
        "心疾患": 0.05,
        "脳血管疾患": 0.03,
        "その他": 0.10,
    },
    # 20-29歳: 青年期（自殺が第1位、死亡率21.3/10万人）
    "20-29": {
        "自殺": 0.50,
        "悪性新生物＜腫瘍＞": 0.12,
        "不慮の事故": 0.10,
        "心疾患": 0.08,
        "脳血管疾患": 0.05,
        "その他": 0.15,
    },
    # 30-39歳: 壮年期前期（自殺が第1位だが、がんも増加）
    "30-39": {
        "自殺": 0.40,
        "悪性新生物＜腫瘍＞": 0.25,
        "心疾患": 0.10,
        "脳血管疾患": 0.08,
        "不慮の事故": 0.07,
        "その他": 0.10,
    },
    # 40-49歳: 壮年期（悪性新生物が第1位に）
    "40-49": {
        "悪性新生物＜腫瘍＞": 0.40,
        "自殺": 0.20,
        "心疾患": 0.15,
        "脳血管疾患": 0.10,
        "不慮の事故": 0.05,
        "その他": 0.10,
    },
    # 50-59歳: 中年期（悪性新生物が圧倒的）
    "50-59": {
        "悪性新生物＜腫瘍＞": 0.45,
        "心疾患": 0.15,
        "脳血管疾患": 0.08,
        "自殺": 0.08,
        "肝疾患": 0.05,
        "その他": 0.19,
    },
    # 60-69歳: 高齢期前期
    "60-69": {
        "悪性新生物＜腫瘍＞": 0.45,
        "心疾患": 0.15,
        "脳血管疾患": 0.10,
        "肺炎": 0.05,
        "不慮の事故": 0.05,
        "その他": 0.20,
    },
    # 70-79歳: 高齢期（悪性新生物が第1位だが、心疾患・肺炎も増加）
    "70-79": {
        "悪性新生物＜腫瘍＞": 0.35,
        "心疾患": 0.15,
        "脳血管疾患": 0.10,
        "肺炎": 0.08,
        "老衰": 0.05,
        "その他": 0.27,
    },
    # 80-89歳: 後期高齢期（老衰が増加）
    "80-89": {
        "悪性新生物＜腫瘍＞": 0.25,
        "心疾患": 0.18,
        "老衰": 0.15,
        "脳血管疾患": 0.10,
        "肺炎": 0.10,
        "その他": 0.22,
    },
    # 90歳以上: 超高齢期（老衰が第1位）
    "90-99": {
        "老衰": 0.30,
        "心疾患": 0.20,
        "悪性新生物＜腫瘍＞": 0.15,
        "肺炎": 0.12,
        "脳血管疾患": 0.08,
        "その他": 0.15,
    },
}


def get_age_group_for_death_cause(age: int) -> str:
    """
    年齢から死因選択用の年代グループを取得
    
    Args:
        age: 死亡年齢
        
    Returns:
        年代グループ文字列（"0-9", "10-19", ... "90-99"）
    """
    if age < 10:
        return "0-9"
    elif age < 20:
        return "10-19"
    elif age < 30:
        return "20-29"
    elif age < 40:
        return "30-39"
    elif age < 50:
        return "40-49"
    elif age < 60:
        return "50-59"
    elif age < 70:
        return "60-69"
    elif age < 80:
        return "70-79"
    elif age < 90:
        return "80-89"
    else:
        return "90-99"
