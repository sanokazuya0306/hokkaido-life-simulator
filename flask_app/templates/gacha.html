{% extends "base.html" %}

{% block content %}
<div class="gacha-container">
    <!-- åœ°åŸŸã‚»ãƒ¬ã‚¯ã‚¿ -->
    <div class="region-selector">
        <a href="{{ url_for('set_region', region='hokkaido') }}" 
           class="region-btn region-btn-left {{ 'region-btn-active' if region == 'hokkaido' else 'region-btn-inactive' }}">
            åŒ—æµ·é“
        </a>
        <a href="{{ url_for('set_region', region='tokyo') }}" 
           class="region-btn region-btn-right {{ 'region-btn-active' if region == 'tokyo' else 'region-btn-inactive' }}">
            æ±äº¬
        </a>
    </div>
    
    <!-- ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ -->
    <div class="slider-container">
        <form id="slider-form" action="{{ url_for('set_num_people') }}" method="POST">
            <div class="slider-value" id="slider-display">{{ num_people }}</div>
            <input type="range" name="num_people" id="num-slider" 
                   min="1" max="20" value="{{ num_people }}"
                   oninput="updateSlider(this.value)">
        </form>
    </div>
    
    <!-- ã‚¬ãƒãƒ£ãƒœã‚¿ãƒ³ -->
    <a href="{{ url_for('pull_gacha') }}" class="gacha-button">
        ã‚¬ãƒãƒ£ã‚’å¼•ã
    </a>
    
    <!-- æƒ…å ±ãƒœã‚¿ãƒ³ -->
    <div class="info-buttons">
        <button class="info-btn" onclick="showRatesModal()">ç¢ºç‡</button>
        <button class="info-btn" onclick="showCorrelationModal()">ç›¸é–¢å›³</button>
        <button class="info-btn" onclick="showDatasetModal()">ãƒ‡ãƒ¼ã‚¿</button>
    </div>
</div>

<!-- ç¢ºç‡ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="rates-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">ğŸ² ã‚¬ãƒãƒ£ç¢ºç‡</span>
            <button class="modal-close" onclick="closeModal('rates-modal')">&times;</button>
        </div>
        <div id="rates-content"></div>
        <p style="margin-top: 16px; font-size: 14px; color: #666;">
            ç¢ºç‡ã¯10,000å›ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆ2026å¹´1æœˆè¨ˆç®—ã€å¯¿å‘½40%ãƒ»ç”Ÿæ¶¯å¹´å35%ãƒ»å­¦æ­´25%ï¼‰ã«åŸºã¥ãã¾ã™ã€‚
        </p>
    </div>
</div>

<!-- ç›¸é–¢å›³ãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="correlation-modal">
    <div class="modal-content" style="max-width: 900px;">
        <div class="modal-header">
            <span class="modal-title">ğŸ“Š ç›¸é–¢å›³</span>
            <button class="modal-close" onclick="closeModal('correlation-modal')">&times;</button>
        </div>
        <p>å‡ºç”Ÿåœ° â†’ ä¸–å¸¯å¹´å â†’ è¦ªã®å­¦æ­´ â†’ é«˜æ ¡é€²å­¦ â†’ å¤§å­¦é€²å­¦ â†’ å°±è· â†’ ç”Ÿæ¶¯å¹´å â†’ äººç”Ÿãƒ©ãƒ³ã‚¯</p>
        <p style="margin-top: 16px;">ã®ç›¸é–¢é–¢ä¿‚ã‚’å¯è¦–åŒ–ã—ãŸã‚µãƒ³ã‚­ãƒ¼ãƒ€ã‚¤ã‚¢ã‚°ãƒ©ãƒ ã§ã™ã€‚</p>
    </div>
</div>

<!-- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ« -->
<div class="modal-overlay" id="dataset-modal">
    <div class="modal-content">
        <div class="modal-header">
            <span class="modal-title">ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ</span>
            <button class="modal-close" onclick="closeModal('dataset-modal')">&times;</button>
        </div>
        <div style="font-size: 14px;">
            <p style="margin-bottom: 12px;"><strong>ğŸ“ å¸‚åŒºç”ºæ‘åˆ¥å‡ºç”Ÿæ•°</strong> - åšç”ŸåŠ´åƒçœ (2024å¹´)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ’° ä¸–å¸¯å¹´ååˆ†å¸ƒ</strong> - ç·å‹™çœçµ±è¨ˆå±€ (2023å¹´)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ“ é«˜æ ¡ãƒ»å¤§å­¦é€²å­¦ç‡</strong> - æ–‡éƒ¨ç§‘å­¦çœ (2024å¹´åº¦)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ« å¤§å­¦é€²å­¦å…ˆéƒ½é“åºœçœŒ</strong> - æ–‡éƒ¨ç§‘å­¦çœ (2024å¹´åº¦)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ“Š æœ€çµ‚å­¦æ­´åˆ†å¸ƒ</strong> - ç·å‹™çœçµ±è¨ˆå±€ (2020å¹´)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ­ ç”£æ¥­åˆ¥å°±æ¥­è€…æ•°</strong> - ç·å‹™çœçµ±è¨ˆå±€ (2024å¹´)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ“ˆ å¹´é½¢åˆ¥æ­»äº¡ç‡</strong> - åšç”ŸåŠ´åƒçœ (2023å¹´)</p>
            <p style="margin-bottom: 12px;"><strong>ğŸ¥ æ­»å› çµ±è¨ˆ</strong> - åšç”ŸåŠ´åƒçœ (2022å¹´)</p>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function updateSlider(value) {
    document.getElementById('slider-display').textContent = value;
}

function showRatesModal() {
    fetch('/api/rates')
        .then(response => response.json())
        .then(data => {
            let html = `<p style="margin-bottom: 16px;"><strong>${data.region_name}ã®ã‚¬ãƒãƒ£ç¢ºç‡</strong></p>`;
            
            const rankColors = {
                'SS': '#1a1a1a',
                'S': '#333333',
                'A': '#4d4d4d',
                'B': '#666666',
                'C': '#808080',
                'D': '#999999'
            };
            
            for (const [rank, rate] of Object.entries(data.rates)) {
                const info = data.rank_info[rank];
                html += `
                    <div class="rate-item" style="border-left-color: ${rankColors[rank]};">
                        <div class="rate-rank" style="background: ${rankColors[rank]}20; color: ${rankColors[rank]};">${rank}</div>
                        <div class="rate-info">
                            <div class="rate-label">${info.label}</div>
                            <div class="rate-desc">${info.desc}</div>
                        </div>
                        <div class="rate-value" style="color: ${rankColors[rank]};">${rate}</div>
                    </div>
                `;
            }
            
            document.getElementById('rates-content').innerHTML = html;
            document.getElementById('rates-modal').classList.add('active');
        });
}

function showCorrelationModal() {
    document.getElementById('correlation-modal').classList.add('active');
}

function showDatasetModal() {
    document.getElementById('dataset-modal').classList.add('active');
}

function closeModal(id) {
    document.getElementById(id).classList.remove('active');
}

// ã‚¯ãƒªãƒƒã‚¯ã§ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚’é–‰ã˜ã‚‹
document.querySelectorAll('.modal-overlay').forEach(modal => {
    modal.addEventListener('click', function(e) {
        if (e.target === this) {
            this.classList.remove('active');
        }
    });
});
</script>
{% endblock %}
